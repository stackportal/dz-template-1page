/*
YUI 3.18.1 (build f7e7bcb)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("get",function(e,t){var n=e.Lang,r,i,s;e.Get=i={cssOptions:{attributes:{rel:"stylesheet"},doc:e.config.linkDoc||e.config.doc,pollInterval:50},jsOptions:{autopurge:!0,doc:e.config.scriptDoc||e.config.doc},options:{attributes:{charset:"utf-8"},purgethreshold:20},REGEX_CSS:/\.css(?:[?;].*)?$/i,REGEX_JS:/\.js(?:[?;].*)?$/i,_insertCache:{},_pending:null,_purgeNodes:[],_queue:[],abort:function(e){var t,n,r,i,s;if(!e.abort){n=e,s=this._pending,e=null;if(s&&s.transaction.id===n)e=s.transaction,this._pending=null;else for(t=0,i=this._queue.length;t<i;++t){r=this._queue[t].transaction;if(r.id===n){e=r,this._queue.splice(t,1);break}}}e&&e.abort()},css:function(e,t,n){return this._load("css",e,t,n)},js:function(e,t,n){return this._load("js",e,t,n)},load:function(e,t,n){return this._load(null,e,t,n)},_autoPurge:function(e){e&&this._purgeNodes.length>=e&&this._purge(this._purgeNodes)},_getEnv:function(){var t=e.config.doc,n=e.UA;return this._env={async:t&&t.createElement("script").async===!0||n.ie>=10,cssFail:n.gecko>=9||n.compareVersions(n.webkit,535.24)>=0,cssLoad:(!n.gecko&&!n.webkit||n.gecko>=9||n.compareVersions(n.webkit,535.24)>=0)&&!(n.chrome&&n.chrome<=18),preservesScriptOrder:!!(n.gecko||n.opera||n.ie&&n.ie>=10)}},_getTransaction:function(t,r){var i=[],o,u,a,f;n.isArray(t)||(t=[t]),r=e.merge(this.options,r),r.attributes=e.merge(this.options.attributes,r.attributes);for(o=0,u=t.length;o<u;++o){f=t[o],a={attributes:{}};if(typeof f=="string")a.url=f;else{if(!f.url)continue;e.mix(a,f,!1,null,0,!0),f=f.url}e.mix(a,r,!1,null,0,!0),a.type||(this.REGEX_CSS.test(f)?a.type="css":(!this.REGEX_JS.test(f),a.type="js")),e.mix(a,a.type==="js"?this.jsOptions:this.cssOptions,!1,null,0,!0),a.attributes.id||(a.attributes.id=e.guid()),a.win?a.doc=a.win.document:a.win=a.doc.defaultView||a.doc.parentWindow,a.charset&&(a.attributes.charset=a.charset),i.push(a)}return new s(i,r)},_load:function(e,t,n,r){var s;return typeof n=="function"&&(r=n,n={}),n||(n={}),n.type=e,n._onFinish=i._onTransactionFinish,this._env||this._getEnv(),s=this._getTransaction(t,n),this._queue.push({callback:r,transaction:s}),this._next(),s},_onTransactionFinish:function(){i._pending=null,i._next()},_next:function(){var e;if(this._pending)return;e=this._queue.shift(),e&&(this._pending=e,e.transaction.execute(e.callback))},_purge:function(t){var n=this._purgeNodes,r=t!==n,i,s;while(s=t.pop()){if(!s._yuiget_finished)continue;s.parentNode&&s.parentNode.removeChild(s),r&&(i=e.Array.indexOf(n,s),i>-1&&n.splice(i,1))}}},i.script=i.js,i.Transaction=s=function(t,n){var r=this;r.id=s._lastId+=1,r.data=n.data,r.errors=[],r.nodes=[],r.options=n,r.requests=t,r._callbacks=[],r._queue=[],r._reqsWaiting=0,r.tId=r.id,r.win=n.win||e.config.win},s._lastId=0,s.prototype={_state:"new",abort:function(e){this._pending=null,this._pendingCSS=null,this._pollTimer=clearTimeout(this._pollTimer),this._queue=[],this._reqsWaiting=0,this.errors.push({error:e||"Aborted"}),this._finish()},execute:function(e){var t=this,n=t.requests,r=t._state,i,s,o,u;if(r==="done"){e&&e(t.errors.length?t.errors:null,t);return}e&&t._callbacks.push(e);if(r==="executing")return;t._state="executing",t._queue=o=[],t.options.timeout&&(t._timeout=setTimeout(function(){t.abort("Timeout")},t.options.timeout)),t._reqsWaiting=n.length;for(i=0,s=n.length;i<s;++i)u=n[i],u.async||u.type==="css"?t._insert(u):o.push(u);t._next()},purge:function(){i._purge(this.nodes)},_createNode:function(e,t,n){var i=n.createElement(e),s,o;r||(o=n.createElement("div"),o.setAttribute("class","a"),r=o.className==="a"?{}:{"for":"htmlFor","class":"className"});for(s in t)t.hasOwnProperty(s)&&i.setAttribute(r[s]||s,t[s]);return i},_finish:function(){var e=this.errors.length?this.errors:null,t=this.options,n=t.context||this,r,i,s;if(this._state==="done")return;this._state="done";for(i=0,s=this._callbacks.length;i<s;++i)this._callbacks[i].call(n,e,this);r=this._getEventData(),e?(t.onTimeout&&e[e.length-1].error==="Timeout"&&t.onTimeout.call(n,r),t.onFailure&&t.onFailure.call(n,r)):t.onSuccess&&t.onSuccess.call(n,r),t.onEnd&&t.onEnd.call(n,r),t._onFinish&&t._onFinish()},_getEventData:function(t){return t?e.merge(this,{abort:this.abort,purge:this.purge,request:t,url:t.url,win:t.win}):this},_getInsertBefore:function(t){var n=t.doc,r=t.insertBefore,s,o;return r?typeof r=="string"?n.getElementById(r):r:(s=i._insertCache,o=e.stamp(n),(r=s[o])?r:(r=n.getElementsByTagName("base")[0])?s[o]=r:(r=n.head||n.getElementsByTagName("head")[0],r?(r.appendChild(n.createTextNode("")),s[o]=r.lastChild):s[o]=n.getElementsByTagName("script")[0]))},_insert:function(t){function c(){u._progress("Failed to load "+t.url,t)}function h(){f&&clearTimeout(f),u._progress(null,t)}var n=i._env,r=this._getInsertBefore(t),s=t.type==="js",o=t.node,u=this,a=e.UA,f,l;o||(s?l="script":!n.cssLoad&&a.gecko?l="style":l="link",o=t.node=this._createNode(l,t.attributes,t.doc)),s?(o.setAttribute("src",t.url),t.async?o.async=!0:(n.async&&(o.async=!1),n.preservesScriptOrder||(this._pending=t))):!n.cssLoad&&a.gecko?o.innerHTML=(t.attributes.charset?'@charset "'+t.attributes.charset+'";':"")+'@import "'+t.url+'";':o.setAttribute("href",t.url),s&&a.ie&&(a.ie<9||document.documentMode&&document.documentMode<9)?o.onreadystatechange=function(){/loaded|complete/.test(o.readyState)&&(o.onreadystatechange=null,h())}:!s&&!n.cssLoad?this._poll(t):(a.ie>=10?(o.onerror=function(){setTimeout(c,0)},o.onload=function(){setTimeout(h,0)}):(o.onerror=c,o.onload=h),!n.cssFail&&!s&&(f=setTimeout(c,t.timeout||3e3))),this.nodes.push(o),r.parentNode.insertBefore(o,r)},_next:function(){if(this._pending)return;this._queue.length?this._insert(this._queue.shift()):this._reqsWaiting||this._finish()},_poll:function(t){var n=this,r=n._pendingCSS,i=e.UA.webkit,s,o,u,a,f,l;if(t){r||(r=n._pendingCSS=[]),r.push(t);if(n._pollTimer)return}n._pollTimer=null;for(s=0;s<r.length;++s){f=r[s];if(i){l=f.doc.styleSheets,u=l.length,a=f.node.href;while(--u>=0)if(l[u].href===a){r.splice(s,1),s-=1,n._progress(null,f);break}
}else try{o=!!f.node.sheet.cssRules,r.splice(s,1),s-=1,n._progress(null,f)}catch(c){}}r.length&&(n._pollTimer=setTimeout(function(){n._poll.call(n)},n.options.pollInterval))},_progress:function(e,t){var n=this.options;e&&(t.error=e,this.errors.push({error:e,request:t})),t.node._yuiget_finished=t.finished=!0,n.onProgress&&n.onProgress.call(n.context||this,this._getEventData(t)),t.autopurge&&(i._autoPurge(this.options.purgethreshold),i._purgeNodes.push(t.node)),this._pending===t&&(this._pending=null),this._reqsWaiting-=1,this._next()}}},"@VERSION@",{requires:["yui-base"]});
/*
YUI 3.18.1 (build f7e7bcb)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("cookie",function(e,t){function h(e){throw new TypeError(e)}function p(e){(!s(e)||e==="")&&h("Cookie name must be a non-empty string.")}function d(e){(!s(e)||e==="")&&h("Subcookie name must be a non-empty string.")}var n=e.Lang,r=e.Object,i=null,s=n.isString,o=n.isObject,u=n.isUndefined,a=n.isFunction,f=encodeURIComponent,l=decodeURIComponent,c=e.config.doc;e.Cookie={_createCookieString:function(e,t,n,r){r=r||{};var i=f(e)+"="+(n?f(t):t),u=r.expires,a=r.path,l=r.domain;return o(r)&&(u instanceof Date&&(i+="; expires="+u.toUTCString()),s(a)&&a!==""&&(i+="; path="+a),s(l)&&l!==""&&(i+="; domain="+l),r.secure===!0&&(i+="; secure")),i},_createCookieHashString:function(e){o(e)||h("Cookie._createCookieHashString(): Argument must be an object.");var t=[];return r.each(e,function(e,n){!a(e)&&!u(e)&&t.push(f(n)+"="+f(String(e)))}),t.join("&")},_parseCookieHash:function(e){var t=e.split("&"),n=i,r={};if(e.length)for(var s=0,o=t.length;s<o;s++)n=t[s].split("="),r[l(n[0])]=l(n[1]);return r},_parseCookieString:function(e,t,n){var r={};if(s(e)&&e.length>0){var o=t===!1?function(e){return e}:l,a=e.split(/;\s/g),f=i,c=i,h=i;for(var p=0,d=a.length;p<d;p++){h=a[p].match(/([^=]+)=/i);if(h instanceof Array)try{f=l(h[1]),c=o(a[p].substring(h[1].length+1))}catch(v){}else f=l(a[p]),c="";!u(n)&&n.reverseCookieLoading?u(r[f])&&(r[f]=c):r[f]=c}}return r},_setDoc:function(e){c=e},exists:function(e){p(e);var t=this._parseCookieString(c.cookie,!0);return t.hasOwnProperty(e)},get:function(e,t){p(e);var n,r,s;return a(t)?(s=t,t={}):o(t)?s=t.converter:t={},n=this._parseCookieString(c.cookie,!t.raw,t),r=n[e],u(r)?i:a(s)?s(r):r},getSub:function(e,t,n,r){var s=this.getSubs(e,r);return s!==i?(d(t),u(s[t])?i:a(n)?n(s[t]):s[t]):i},getSubs:function(e,t){p(e);var n=this._parseCookieString(c.cookie,!1,t);return s(n[e])?this._parseCookieHash(n[e]):i},remove:function(t,n){return p(t),n=e.merge(n||{},{expires:new Date(0)}),this.set(t,"",n)},removeSub:function(e,t,n){p(e),d(t),n=n||{};var r=this.getSubs(e);if(o(r)&&r.hasOwnProperty(t)){delete r[t];if(!n.removeIfEmpty)return this.setSubs(e,r,n);for(var i in r)if(r.hasOwnProperty(i)&&!a(r[i])&&!u(r[i]))return this.setSubs(e,r,n);return this.remove(e,n)}return""},set:function(e,t,n){p(e),u(t)&&h("Cookie.set(): Value cannot be undefined."),n=n||{};var r=this._createCookieString(e,t,!n.raw,n);return c.cookie=r,r},setSub:function(e,t,n,r){p(e),d(t),u(n)&&h("Cookie.setSub(): Subcookie value cannot be undefined.");var i=this.getSubs(e);return o(i)||(i={}),i[t]=n,this.setSubs(e,i,r)},setSubs:function(e,t,n){p(e),o(t)||h("Cookie.setSubs(): Cookie value must be an object.");var r=this._createCookieString(e,this._createCookieHashString(t),!1,n);return c.cookie=r,r}}},"3.18.1",{requires:["yui-base"]});
YUI().use("event","cookie","io-xdr","querystring-stringify-simple","json-parse",function(a){RightNow.namespace("RightNow.Chat.UI");RightNow.Chat.UI=RightNow.Chat.UI||{};RightNow.Chat.UI.EventBus=function(){function b(a,b){b=b[0];k.setConnectionParameters(b.data.connectionData);var c=b.data.surveyCompID,d=b.data.surveyTermID,f=b.data.surveyCompAuth,e=b.data.surveyTermAuth;v=b.data.surveyBaseUrl;c&&k.setCompletedSurveyID(c);d&&k.setCancelledSurveyID(d);f&&k.setCompletedSurveyAuth(f);e&&k.setCancelledSurveyAuth(e);y=b.data.terminateChatSessionString;RightNow.Event.fire("evt_chatSetParametersResponse",b)}function c(a,b){b=b[0];b.data.valid=RightNow.Chat.UI.Validator.validate(b.data);RightNow.Event.fire("evt_chatValidateParametersResponse",b)}function d(a,b){b=b[0];var c=!1;if(b.data.firstNameRequired&&!b.data.firstName||b.data.lastNameRequired&&!b.data.lastName||b.data.emailRequired&&!b.data.email)c=!0;b.data.anonymousRequest=c;RightNow.Event.fire("evt_chatCheckAnonymousResponse",b)}function f(a,b){k.logon(b[0])}function m(a,b){k.logonRest(b[0])}function e(a,b){RightNow.Event.fire("evt_chatConnectResponse",b[0])}function g(a,b){k.fetchUpdate()}function p(a,b){RightNow.Event.fire("evt_chatFetchUpdateResponse",b[0])}function l(a,b){RightNow.Event.fire("evt_chatStateChangeResponse",b[0]);window.oit&&window.oit.fire(new CustomEvent("inlay-oracle-chat-stateChange",{detail:b[0].data}));if(b[0].data.currentState===RightNow.Chat.Model.ChatState.DISCONNECTED&&!window.opener){var c=k.getCompletedSurveyID();if(0!==c){var d=v+"/5/"+c+"/7/"+k.getEngagementID()+"/12/"+k.getCompletedSurveyAuth()+"/15/"+k.getEncodedAccountID();"AGENT_CONCLUDED"===b[0].data.reason?setTimeout(function(){s(d,b[0].data.openInWindow)},3E3):s(d,b[0].data.openInWindow)}}}function q(a,b){RightNow.Event.fire("evt_chatAgentStatusChangeResponse",b[0])}function w(a,b){RightNow.Event.fire("evt_chatEngagementParticipantAddedResponse",b[0])}function t(a,b){var c=b[0].data.reason,d=RightNow.Chat.Model.ChatDisconnectReason;c===d.PARTICIPANT_LEFT||c===d.TRANSFERRED_TO_QUEUE||c===d.CONFREE_DISCONNECTED?RightNow.Event.fire("evt_chatEngagementParticipantRemovedResponse",b[0]):(c===d.AGENT_CONCLUDED||b[0].data.isUserDisconnect)&&RightNow.Event.fire("evt_chatEngagementConcludedResponse",b[0])}function r(b,c){k.logoff(!1,c[0].data.isCancelled);if(c[0].data.isCancelled){var d=k.getCancelledSurveyID(),f=a.Lang.trim(c[0].data.cancelingUrl);0!==d?(s(v+"/5/"+d+"/7/"+k.getEngagementID()+"/12/"+k.getCancelledSurveyAuth()),setTimeout("window.close()",2E3)):""!==f&&(s(f),setTimeout("window.close()",2E3))}}function u(a,b){null==b[0].data.isOffTheRecord&&(b[0].data.isOffTheRecord=!1);b[0].data.isEndUserPost&&(b[0].data.endUser=k.getEndUser(),!1!==b[0].data.postMessage&&(b[0].data.messageId=k.postMessage(b[0].data.messageBody,b[0].data.isOffTheRecord)));RightNow.Event.fire("evt_chatPostResponse",b[0])}function x(a,b){b[0].data.inputValue.length>b[0].data.inputValueBeforeChange.length&&!k.isMessageAllowed(b[0].data.inputValue,b[0].data.isOffTheRecord)&&RightNow.Event.fire("evt_chatPostLengthExceededResponse",b[0]);k.handleChatPostMessageKeyUp(b[0].data.keyEvent,b[0].data.inputValue)}function A(a,b){k.postOutOfBandData(b[0].data)}function B(a,b){RightNow.Event.fire("evt_chatVaPassthroughMessageResponse",b[0])}function C(a,b){RightNow.Event.fire("evt_chatQueuePositionNotificationResponse",b[0])}function D(a,b){RightNow.Event.fire("evt_chatSendButtonClickResponse",b[0])}function E(a,b){var c=++n.transactionID;n[c]={};k.notifyFileAttach()}function F(a,b){b[0].transactionID=n.transactionID;RightNow.Event.fire("evt_chatNotifyFattachUpdateResponse",b[0])}function z(a,b){var c=b[0].data.transactionID;n[c].canceled?b[0].data.error=2:n[c].timedOut&&(b[0].data.error=20);n[c].notified||(n[c].notified=!0,k.notifyFileUploaded(b[0]))}function G(a,b){RightNow.Event.fire("evt_fileUploadUpdateResponse",b[1])}function H(a,b){n[n.transactionID]&&(n[n.transactionID].canceled=!0,b[0].data.transactionID=n.transactionID,z(a,b))}function I(a,b){RightNow.Event.fire("evt_chatCobrowseInvitationResponse",b[0])}function J(a,b){RightNow.Event.fire("evt_chatCoBrowsePremiumInvitationResponse",b[0])}function K(a,b){b[0].data.accepted=!0;RightNow.Event.fire("evt_chatCobrowseAcceptResponse",b[0]);k.sendCoBrowseAction(RightNow.Chat.Model.ChatCoBrowseStatusCode.ACCEPTED)}function L(a,b){b[0].data.accepted=!0;RightNow.Event.fire("evt_chatCoBrowsePremiumAcceptResponse",b[0]);k.sendCoBrowseAction(RightNow.Chat.Model.ChatCoBrowseStatusCode.ACCEPTED)}function M(a,b){b[0].data.accepted=!1;RightNow.Event.fire("evt_chatCobrowseAcceptResponse",b[0]);k.sendCoBrowseAction(RightNow.Chat.Model.ChatCoBrowseStatusCode.DECLINED)}function N(a,b){b[0].data.accepted=!1;RightNow.Event.fire("evt_chatCoBrowsePremiumAcceptResponse",b[0]);k.sendCoBrowseAction(RightNow.Chat.Model.ChatCoBrowseStatusCode.DECLINED)}function O(a,b){RightNow.Event.fire("evt_chatCobrowseStatusResponse",b[0])}function P(a,b){RightNow.Event.fire("evt_chatVideoChatInvitationResponse",b[0])}function Q(a,b){b[0].data.accepted=!0;RightNow.Event.fire("evt_chatVideoChatAcceptResponse",b[0]);this.videoInlayLoaded||k.sendVideoChatAction(RightNow.Chat.Model.ChatVideoChatStatusCode.ACCEPTED,b[0].data.videoChatSessionId)}function R(a,b){b[0].data.accepted=!1;RightNow.Event.fire("evt_chatVideoChatAcceptResponse",b[0]);this.videoInlayLoaded||k.sendVideoChatAction(RightNow.Chat.Model.ChatVideoChatStatusCode.DECLINED)}function S(a,b){this.videoInlayLoaded&&window.oit?window.oit.fire(new CustomEvent("inlay-oracle-chat-video-statusNotification",{detail:{videoChatStatus:b[0].data.videoChatStatus,clientResponsible:!1,fromAgent:!0,isRestoringTranscript:b[0].data.isRestoringTranscript}})):RightNow.Event.fire("evt_chatVideoChatStatusResponse",b[0])}function T(a,b){k.sendVideoChatAction(RightNow.Chat.Model.ChatVideoChatStatusCode.STARTED)}function U(a,b){k.sendVideoChatAction(RightNow.Chat.Model.ChatVideoChatStatusCode.STOPPED)}function V(a,b){k.sendVideoChatAction(RightNow.Chat.Model.ChatVideoChatStatusCode.ABORTED)}function W(a,b){k.sendVideoChatAction(RightNow.Chat.Model.ChatVideoChatStatusCode.ERROR)}function X(a,b){RightNow.Event.fire("evt_chatOffTheRecordButtonClickResponse",b[0])}function Y(a,b){var c=k.getCompletedSurveyID(),d=!1;0!==c?(d=!0,s(v+"/5/"+c+"/7/"+k.getEngagementID()+"/12/"+k.getCompletedSurveyAuth()+"/15/"+k.getEncodedAccountID())):b[0].data.closingUrl&&""!==b[0].data.closingUrl&&s(b[0].data.closingUrl,b[0].data.openInWindow);d?setTimeout("window.close()",500):window.close()}function Z(a,b){k.setSearchPerformed(!0)}function $(a,b){RightNow.Event.fire("evt_chatReconnectUpdateResponse",b[0])}function aa(a,b){RightNow.Event.fire("evt_chatAgentAbsentUpdateResponse",b[0]);window.oit&&window.oit.fire(new CustomEvent("inlay-oracle-chat-agentAbsentUpdate",{detail:b[0]}))}function s(a,b){a.match(/^(http[s]?|ftp):\/\//i)||(a=a.match(/^ftp\./i)?"ftp://"+a:"http://"+a);b&&"new_window"!==b&&("parent_window"!==b||window.opener&&!window.opener.closed)?window.opener.location=a:window.open(a)}var k=null,n={transactionID:-1},v=null,y=null;this.initializeEventBus=function(){var h=RightNow.Event,n=RightNow.Chat.Controller;n.ChatCommunicationsController=new n.ChatCommunicationsController(a);k=n.ChatCommunicationsController;k.initializeCommunications();h.subscribe("evt_chatSetParametersRequest",b);h.subscribe("evt_chatValidateParametersRequest",c);h.subscribe("evt_chatCheckAnonymousRequest",d);h.subscribe("evt_chatConnectRequest",f);h.subscribe("evt_chatConnectRestRequest",m);h.subscribe("evt_chatConnectUpdate",e);h.subscribe("evt_chatFetchUpdateRequest",g);h.subscribe("evt_chatFetchUpdateComplete",p);h.subscribe("evt_chatStateChange",l);h.subscribe("evt_chatEngagementParticipantAdded",w);h.subscribe("evt_chatAgentStatusChange",q);h.subscribe("evt_chatDisconnectNotification",t);h.subscribe("evt_chatHangupRequest",r);h.subscribe("evt_chatPostMessageRequest",u);h.subscribe("evt_chatQueuePositionNotification",C);h.subscribe("evt_chatPostMessageKeyUpRequest",x);h.subscribe("evt_chatSendButtonClickRequest",D);h.subscribe("evt_chatNotifyFattachLocalRequest",E);h.subscribe("evt_chatNotifyFattachUpdate",F);h.subscribe("evt_chatNotifyFileUploadRequest",z);h.subscribe("evt_chatNotifyFileUploadUpdate",G);h.subscribe("evt_fileUploadCancelRequest",H);h.subscribe("evt_chatCobrowseInvitation",I);h.subscribe("evt_chatCoBrowseAcceptRequest",K);h.subscribe("evt_chatCoBrowseDenyRequest",M);h.subscribe("evt_chatCobrowseStatusNotification",O);h.subscribe("evt_chatCoBrowsePremiumInvitation",J);h.subscribe("evt_chatCoBrowsePremiumAcceptRequest",L);h.subscribe("evt_chatCoBrowsePremiumDenyRequest",N);h.subscribe("evt_chatVideoChatInvitation",P);h.subscribe("evt_chatVideoChatAcceptRequest",Q,this);h.subscribe("evt_chatVideoChatDenyRequest",R,this);h.subscribe("evt_chatVideoChatStart",T);h.subscribe("evt_chatVideoChatStop",U);h.subscribe("evt_chatVideoChatError",W);h.subscribe("evt_chatVideoChatAbort",V);h.subscribe("evt_chatVideoChatStatusNotification",S,this);h.subscribe("evt_chatOffTheRecordButtonClickRequest",X);h.subscribe("evt_chatCloseButtonClickRequest",Y);h.subscribe("evt_searchRequest",Z);h.subscribe("evt_chatReconnectUpdate",$);h.subscribe("evt_chatAgentAbsentUpdate",aa);h.subscribe("evt_chatPostOutOfBandDataRequest",A);h.subscribe("evt_chatVaPassthroughMessage",B);h.fire("evt_chatEventBusInitializedResponse",null);window.oit&&window.oit.allInlaysAreLoaded()?this._onOITLoaded():document.addEventListener("inlay-oracle-chat-video-loaded",this._onOITLoaded.bind(this));this._eventBusInitialized=!0};this._onOITLoaded=function(){this.videoInlayLoaded=!0};this.isEventBusInitialized=function(){return this._eventBusInitialized};this.onWindowClose=function(){if(k.isConnected())return y};this.onWindowUnload=function(){a.Cookie.get("pc_chat_state")?k.setNavigationType(RightNow.Chat.Model.NavigationType.NAVIGATE_AWAY):k.logoff(!0)}};RightNow.Chat.UI.Util||(RightNow.Chat.UI.Util={_leaveScreenIssues:void 0,doPositionAndWaitTimeVariableSubstitution:function(a,c,d){a=this.replaceStringAndSurroundingSpace(a,"${queue-position}","<span id='rn_"+c+"_QueuePosition'></span>");a=a.replace("${wait-time-samples}",d);a=this.replaceStringAndSurroundingSpace(a,"${estimated-wait-time}","<span id='rn_"+c+"_EstimatedWaitTime'></span>");return a=this.replaceStringAndSurroundingSpace(a,"${average-wait-time}","<span id='rn_"+c+"_AverageWaitTime'></span>")},replaceStringAndSurroundingSpace:function(a,c,d){a=a.replace(" "+c+" ","&nbsp;"+d+"&nbsp;");a=a.replace(" "+c,"&nbsp;"+d);a=a.replace(c+" ",d+"&nbsp;");return a=a.replace(c,d)},toIso8601Time:function(a){if(0>=a)return a;var c,d,f=0;c=Math.floor(a/3600);d=Math.floor(a%3600/60);f=a%60;a="";0<c&&(a=(10>c?"0"+c:c)+":");a=10>d?a+"0"+d:a+d;a+=":";return a=10>f?a+"0"+f:a+f},hasLeaveScreenIssues:function(){if(void 0===this._leaveScreenIssues&&(this._leaveScreenIssues=!1,10<=a.UA.ie)){var b=!1;try{b=!!new ActiveXObject("htmlfile")}catch(c){}b||window.innerWidth!==screen.width||window.innerHeight!==screen.height||(this._leaveScreenIssues=!0)}return this._leaveScreenIssues}});RightNow.Chat.UI.Validator||(RightNow.Chat.UI.Validator={validate:function(a){return a.email&&!RightNow.Text.isValidEmailAddress(a.email)||a.prod&&!this.isInteger(a.prod)||a.cat&&!this.isInteger(a.cat)||!this.validateCustomFields(a.miscellaneousData,a.customFields)?!1:!0},validateCustomFields:function(a,c){if(!a)return!0;for(var d in a)if(!this.validateCustomField(d,a[d],c))return!1;return!0},validateCustomField:function(a,c,d){a=a.substring(a.indexOf(".c.")+1).replace(".","$");var f=!1,m;for(m in d)if(d[m].col_name===a){f=d[m];break}if(!f)return!1;switch(f.data_type){case RightNow.Interface.Constants.EUF_DT_DATE:case RightNow.Interface.Constants.EUF_DT_DATETIME:if(!this.isValidDateTime(c))return!1;break;case RightNow.Interface.Constants.EUF_DT_INT:if(!this.isInteger(c))return!1;c=parseInt(c,10);if(f.min_val&&c<parseInt(f.min_val,10)||f.max_val&&c>parseInt(f.max_val,10))return!1;break;case RightNow.Interface.Constants.EUF_DT_RADIO:if(!this.isInteger(c)||"0"!=c&&"1"!=c)return!1}return!0},isInteger:function(a){return/^-?\d+$/.test(a)},isValidDateTime:function(a){var c=null;if(/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})[+-](\d{2})\:(\d{2})/.test(a))c=new Date(a);else{var c=/^\d{1,2}(:\d{1,2}){1,2}$/,d=a.split(" ");if(!/^\d{4}-\d{1,2}-\d{1,2}$/.test(d[0])||d[1]&&!c.test(d[1]))return!1;a=d[0].split("-");c=(d=d[1]?d[1].split(":"):null)?new Date(a[0],a[1]-1,a[2],d[0],d[1]):new Date(a[0],a[1]-1,a[2]);if(c.getFullYear()!=a[0]||c.getMonth()+1!=a[1]||c.getDate()!=a[2]||null!=d&&(c.getHours()!=d[0]||c.getMinutes()!=d[1]))return!1}a=new Date(2038,0,18);return c<new Date(1970,0,2)||c>=a?!1:!0}});a.on("domready",function(){var b=!1;try{b=!a.Cookie.get("pc_chat_state")||a.Cookie.get("pc_chat_state")!==RightNow.Text.Encoding.base64Encode("max")&&a.Cookie.get("pc_chat_state")!==RightNow.Text.Encoding.base64Encode("min")?!1:!0}catch(c){}if(!b||a.Cookie.get("CHAT_SESSION_ID")||"y"!=a.Cookie.get("pc_ls_support")){var d=RightNow.Chat.UI;d.EventBus=new d.EventBus;"complete"!==document.readyState?document.onreadystatechange=function(){"complete"===document.readyState&&d.EventBus.initializeEventBus()}:d.EventBus.initializeEventBus();a.UA.ipad||a.UA.iphone?window.onpagehide=d.EventBus.onWindowUnload:(a.UA.android?window.onbeforeunload=d.EventBus.onWindowUnload:(window.onbeforeunload=d.EventBus.onWindowUnload,window.onpagehide=d.EventBus.onWindowUnload),window.onunload=d.EventBus.onWindowUnload);window.ondragover=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;return!1};window.ondrop=function(a){var b=a.target;if("INPUT"!==b.tagName||"file"!==b.type)return a.preventDefault?a.preventDefault():a.returnValue=!1,!1};a.on("key",function(a){a.preventDefault()},a.one(document),"down:27")}},this)});RightNow.Chat&&RightNow.Chat.Model||(RightNow.namespace("RightNow.Chat.Model"),RightNow.Chat.Model={ChatEndUserAction:{LOGON:"LOGON",LOGOFF:"LOGOFF",GETUPDATE:"GETUPDATE",SEND_TEXT:"SEND_TEXT",ACTIVITY_STATUS:"ACTIVITY_STATUS",PROACTIVE_QUERY:"PROACTIVE_QUERY",COBROWSE:"COBROWSE",NOTIFY_FATTACH:"NOTIFY_FATTACH",FATTACH_UPLOAD:"FATTACH_UPLOAD",OUT_OF_BAND_DATA:"OUT_OF_BAND_DATA",VIDEOCHAT:"VIDEOCHAT"},ChatState:{UNDEFINED:0,SEARCHING:1,CONNECTED:2,REQUEUED:3,CANCELLED:4,DEQUEUED:5,DISCONNECTED:6,RECONNECTING:7},ChatCreateEngagementResumeCode:{NONE:"NONE",RESUME:"RESUME",DO_NOT_RESUME:"DO_NOT_RESUME"},ChatActivityState:{LISTENING:"LISTENING",RESPONDING:"RESPONDING",ABSENT:"ABSENT"},ChatSneakPreviewState:{NONE:"NONE",ENABLED:"ENABLED",DISABLED:"DISABLED",SITE_UNAVAILABLE:"SITE_UNAVAILABLE",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE"},ChatParticipantConnectionState:{ABSENT:"ABSENT",ACTIVE:"ACTIVE",DISCONNECTED:"DISCONNECTED"},ChatConclusionReason:{ENDED_USER_CANCEL:"ENDED_USER_CANCEL",ENDED_USER_DEFLECTED:"ENDED_USER_DEFLECTED"},ChatDisconnectReason:{AGENT_CONCLUDED:"AGENT_CONCLUDED",END_USER_CONCLUDED:"END_USER_CONCLUDED",QUEUE_TIMEOUT:"QUEUE_TIMEOUT",IDLE_TIMEOUT:"IDLE_TIMEOUT",EJECTED:"EJECTED",TRANSFERRED_TO_QUEUE:"TRANSFERRED_TO_QUEUE",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",NO_AGENTS_AVAILABLE:"NO_AGENTS_AVAILABLE",BROWSER_UNSUPPORTED:"BROWSER_UNSUPPORTED",ENDED_USER_CANCEL:"ENDED_USER_CANCEL",ENDED_USER_DEFLECTED:"ENDED_USER_DEFLECTED",FAIL_NO_AGENTS_AVAIL:"FAIL_NO_AGENTS_AVAIL",CONFREE_DISCONNECTED:"CONFREE_DISCONNECTED"},ChatCoBrowseType:{SCREEN_POINTER:"SCREEN_POINTER",SCREEN:"SCREEN",MOUSE_NAVIGATION:"MOUSE_NAVIGATION",DESKTOP_CONTROL:"DESKTOP_CONTROL"},ChatCoBrowseStatusCode:{ACCEPTED:"ACCEPTED",DECLINED:"DECLINED",UNAVAILABLE:"UNAVAILABLE",TIMEOUT:"TIMEOUT",STARTED:"STARTED",STOPPED:"STOPPED",ERROR:"ERROR"},CommunicationMethod:{AJAX_POST:"AJAX_POST",YUI_GET:"YUI_GET",RNW_REDIRECT:"RNW_REDIRECT",XDOMAIN_REQUEST:"XDOMAIN_REQUEST"},ChatVideoChatType:{SCREEN_POINTER:"SCREEN_POINTER",SCREEN:"SCREEN",MOUSE_NAVIGATION:"MOUSE_NAVIGATION",DESKTOP_CONTROL:"DESKTOP_CONTROL"},ChatVideoChatStatusCode:{ACCEPTED:"ACCEPTED",DECLINED:"DECLINED",UNAVAILABLE:"UNAVAILABLE",TIMEOUT:"TIMEOUT",STARTED:"STARTED",STOPPED:"STOPPED",ERROR:"ERROR",ABORTED:"ABORTED"},NavigationType:{NAVIGATE_AWAY:"NAVIGATE_AWAY",ON_PAGE:"ON_PAGE"}},RightNow.Chat.Model.Agents=function(){this._agents={}},RightNow.Chat.Model.Agents.prototype={_leadAgentID:null,addAgent:function(a,b,c,d){b={name:b,greeting:c,clientID:a};this._agents[a]=b;d&&(this._leadAgentID=a);return b},getAgent:function(a){return this._agents[a]},getLeadAgentID:function(){return this._leadAgentID},setLeadAgentID:function(a){this._leadAgentID=a},setActivityStatus:function(a,b){this._agents[a].activityStatus=b}},function(){var a=RightNow.Chat.Model;a.Agents=new a.Agents;a.EndUser={activityStatus:a.ChatActivityState.LISTENING,firstName:"",lastName:"",servletSessionID:"",email:""}}());RightNow.namespace("RightNow.Chat.Communicator");RightNow.Chat=RightNow.Chat||{};RightNow.Chat.Communicator=function(a){this.Y=a;this._communicationMethod=RightNow.Chat.Model.CommunicationMethod.AJAX_POST;this._baseUrl="";this._javaSessionID=this._baseParameters=null;this._redirectUrl="/ci/ajaxRequest/doChatRequest";this._clusterPoolID=this._siteName="";this._appendRandomURLValue=!1;this._lastTransactionID=0};RightNow.Chat.Communicator.prototype={initialize:function(a){var b=navigator.userAgent,c=b.indexOf("Firefox/");-1!==c?3.5<=parseFloat(b.substring(c+8))&&(this._communicationMethod=RightNow.Chat.Model.CommunicationMethod.AJAX_POST):8<=this.Y.UA.ie&&window.XDomainRequest?this._communicationMethod=RightNow.Chat.Model.CommunicationMethod.XDOMAIN_REQUEST:navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")&&-1===b.indexOf("iPhone")?(c=b.indexOf("Version"),-1!==c&&(b=parseFloat(b.substring(c+8)))&&4<=b&&(this._communicationMethod=RightNow.Chat.Model.CommunicationMethod.AJAX_POST)):-1!==b.indexOf("iPhone")?this._appendRandomURLValue=!0:-1!==b.indexOf("Chrome")&&window.XMLHttpRequest&&(this._communicationMethod=RightNow.Chat.Model.CommunicationMethod.AJAX_POST);if(b=this.Y.Cookie.get("CHAT_SESSION_ID"))this._javaSessionID=b;var b=a.useHttps?"s":"",c=a.chatServerHost,d=80===a.chatServerPort||443===a.chatServerPort||-1<a.chatServerHost.indexOf(":")?"":":"+a.chatServerPort,f=a.dbName;this._baseUrl="http"+b+"://"+c+""+d+"/Chat/chat/"+f;this._baseRestUrl="http"+b+"://"+c+""+d+"/engagement/api/consumer/"+f;this._clusterPoolID=RightNow.Interface.getConfig("CHAT_CLUSTER_POOL_ID");this._baseParameters={site_name:a.dbName,responseType:"JSON"};this._siteName=a.dbName},makeRequest:function(a,b){var c,d,f=a.data||{},m=this._communicationMethod,e=a.failureRetry||!1,g=a.scope;a.useTransactionID&&(f.tId=++this._lastTransactionID);a.forceRnwRedirect?(m=RightNow.Chat.Model.CommunicationMethod.RNW_REDIRECT,c=this._redirectUrl,f.jsessionID=this._javaSessionID,f=this.Y.merge(f,{chatAction:f.action||f.chatAction,message:f.msg||f.message,action:null,msg:null})):c=b?this._baseRestUrl+"/v1/requestEngagement":this._baseUrl+(this.includeJavaSessionIDInUrl()?";jsessionid="+this._javaSessionID:"");c=b?c+("?"+(""===a.data.pool?"":"pool="+a.data.pool+"&")):c+("?"+(""===this._clusterPoolID?"":"pool="+this._clusterPoolID+"&"));for(d in f)null!==f[d]&&void 0!==f[d]&&""!==f[d]||delete f[d];d=b?"{}":this.Y.QueryString.stringify(this.Y.merge(this._baseParameters,f));if(a.testAllowed)return!(349525<f.msg.length);var p=this;this.reqTryCount=1;var l={data:d,headers:a.headers,method:"POST",on:{success:function(a,b,c){if(null!==c.success){try{var d=this.Y.JSON.parse(b.responseText);void 0!==c.data&&(d=this.Y.merge(d,{data:c.data}))}catch(f){return}c.success.apply(this,[d])}},failure:function(b,d,f){2>p.reqTryCount?(p.reqTryCount++,setTimeout(function(){p.Y.io(c,l)},2E3)):(l.on.failure=a.on?a.on.failure||null:null,l.on.failure&&setTimeout(function(){p.Y.io(c,l)},2E3))}},arguments:{success:a.on?a.on.success||null:null,data:a.callbackArgument},context:g,timeout:e?15E3:45E3};a.synchronous&&(l.sync=!0);m!==RightNow.Chat.Model.CommunicationMethod.RNW_REDIRECT&&(this.Y.UA.ie&&10>this.Y.UA.ie&&(c+="parametersTextInBody=true",l.xdr={credentials:!0,use:"native"}),this.Y.io.header("X-Requested-With"));b||(l.xdr={credentials:!0,use:"native"});this._javaSessionID&&this.Y.io.header("X-JSESSIONID",this._javaSessionID);"LOGOFF"===f.action&&a.synchronous?this.Y.UA.safari||10<this.Y.UA.ie||this.Y.UA.gecko?(this.makeXmlHttpRequest(c,a,d,!0),this.makeXmlHttpRequest(c,a,d,!1)):this.Y.UA.chrome?this.makeXmlHttpRequest(c,a,d,!0):(new Image).src=c+"&"+d:this.Y.io(c,l)},makeXmlHttpRequest:function(a,b,c,d){var f=new XMLHttpRequest,m=this;f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var a=m.Y.JSON.parse(f.responseText);void 0!==b.data&&(a=m.Y.merge(a,{data:b.data}));b.on.success.apply(b.scope,[a])}};if("withCredentials"in f){f.open("POST",a,d);this._javaSessionID&&f.setRequestHeader("X-JSESSIONID",this._javaSessionID);b.headers&&"Content-Type"in b.headers||f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var e in b.headers)f.setRequestHeader(e,b.headers[e]);f.send(c)}},setJavaSessionID:function(a){this._javaSessionID=a},setClusterPoolID:function(a){this._clusterPoolID=a},getLastTransactionID:function(){return this._lastTransactionID},isXDRTransaction:function(){return this._communicationMethod===RightNow.Chat.Model.CommunicationMethod.XDOMAIN_REQUEST},includeJavaSessionIDInUrl:function(){return this._javaSessionID&&this.Y.UA.ie&&10>this.Y.UA.ie}};RightNow.namespace("RightNow.Chat.Controller");RightNow.Chat.Controller=RightNow.Chat.Controller||{};RightNow.Chat.Controller.ChatCommunicationsController=function(a){this.Y=a;this._absentIntervalMS=12E4;this._activitySignalResponseCheckInterval=3E4;this._activitySignalResponseLastCheckTime=Date.now();this._agents=RightNow.Chat.Model.Agents;this._beginProcessingTimestamp=null;this._completedSurveyID=this._cancelledSurveyID=0;this._chatCommunicator=this._completedSurveyAuth=this._cancelledSurveyAuth=null;this._connected=!1;this._currentState=null;this._currentlySendingMessage=!1;this._endUser=RightNow.Chat.Model.EndUser;this._accountID=this._engagementID=-1;this._fetchUpdateFailures=0;this._firstParticipant=!0;this._postMessageResponseTimer=null;this._postMessageRetryCount=0;this._lastPostedMessageID=-1;this._logonResponseTimer=null;this._maxAbsentIntervals=2;this._responseSentMilliseconds=this._reconnectTimer=this._currentAbsentInterval=this._myClientID=null;this._retryReconnect=!0;this._sneakPreviewFocus=!1;this._sneakPreviewState=RightNow.Chat.Model.ChatSneakPreviewState.DISABLED;this._sneakPreviewInterval=500;this._sneakPreviewLastSentTime=Date.now();this._stateBeforeReconnect=null;this._statusTimerId=0;this._searchPerformed=!1;this._timeUpdateRequested=null;this._messageSendQueue=[];this._xmlDateRE=new RegExp(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(\.[0-9]+)?.*$/);this._navigationType=null;this._exceptionCodeMap={NO_AGENTS_AVAIL:"FAIL_NO_AGENTS_AVAIL",OUT_OF_HOURS:"FAIL_OUT_OF_HOURS",HOLIDAY:"FAIL_HOLIDAY",SERVER_ERROR:"FAIL_SERVER_ERROR",RULE_DEQUEUE:"FAIL_RULE_DEQUEUE"};window.oit&&window.oit.allInlaysAreLoaded()?this._onOITLoaded():document.addEventListener("inlay-oracle-chat-video-loaded",this._onOITLoaded.bind(this))};RightNow.Chat.Controller.ChatCommunicationsController.prototype={initializeCommunications:function(){var a=RightNow.Chat;a.Communicator=new a.Communicator(this.Y);this._chatCommunicator=a.Communicator},_onOITLoaded:function(){this.videoInlayLoaded=!0},setConnectionParameters:function(a){a.absentInterval&&(this._absentIntervalMS=1E3*a.absentInterval);a.absentRetryCount&&(this._maxAbsentIntervals=a.absentRetryCount);this._chatCommunicator.initialize(a)},setState:function(a,b){if(this._currentState!=RightNow.Chat.Model.ChatState.CANCELLED&&this._currentState!=RightNow.Chat.Model.ChatState.DISCONNECTED&&this._currentState!=RightNow.Chat.Model.ChatState.DEQUEUED){var c=new RightNow.Event.EventObject;c.data.previousState=this._currentState;c.data.currentState=this._currentState=a;c.data.reason=b;RightNow.Event.fire("evt_chatStateChange",c)}},setNavigationType:function(a){this._navigationType=a},isConnected:function(){return this._connected},getState:function(){return this._currentState},setAgentActivityStatus:function(a,b){var c=new RightNow.Event.EventObject;null!=this._agents.getAgent(a)&&(c.data.previousState=this._agents.getAgent(a).activityStatus,this._agents.setActivityStatus(a,b),c.data.agent=this._agents.getAgent(a),RightNow.Event.fire("evt_chatAgentStatusChange",c))},setEndUserActivityStatus:function(a,b){this._endUser.activityStatus=a;var c={data:{action:RightNow.Chat.Model.ChatEndUserAction.ACTIVITY_STATUS,mode:a,sneakPreview:b,sneakPreviewState:this._sneakPreviewState,sneakPreviewFocus:this._sneakPreviewFocus}};Date.now()-this._activitySignalResponseLastCheckTime>=this._activitySignalResponseCheckInterval&&(c.on={success:this.onActivitySignalChangeSuccess,failure:this.onActivitySignalChangeFailure},c.scope=this,this._activitySignalResponseLastCheckTime=Date.now());this._chatCommunicator.makeRequest(c)},handleChatPostMessageKeyUp:function(a,b){var c=RightNow.Chat.Model.ChatActivityState,d=this._sneakPreviewState===RightNow.Chat.Model.ChatSneakPreviewState.ENABLED&&this._sneakPreviewFocus;clearTimeout(this._statusTimerId);a&&13===a.keyCode||(""===b&&this._endUser.activityStatus!==c.LISTENING?this.setEndUserActivityStatus(c.LISTENING):d||""===b||this._endUser.activityStatus===c.RESPONDING?d&&null!==b&&0<=b.length&&this.sendSneakPreview(b):this.setEndUserActivityStatus(c.RESPONDING),this._endUser.activityStatus===c.RESPONDING&&(d&&b?(b=b.replace(/\n/g,"\\n"),this._statusTimerId=setTimeout('RightNow.Chat.Controller.ChatCommunicationsController.setEndUserActivityStatus("'+c.LISTENING+'", "'+b+'")',this._sneakPreviewInterval)):this._statusTimerId=setTimeout('RightNow.Chat.Controller.ChatCommunicationsController.setEndUserActivityStatus("'+c.LISTENING+'")',5E3)))},sendSneakPreview:function(a){1===a.length&&(this.setEndUserActivityStatus(RightNow.Chat.Model.ChatActivityState.RESPONDING),this._sneakPreviewLastSentTime=Date.now());Date.now()-this._sneakPreviewLastSentTime>=this._sneakPreviewInterval&&(this.setEndUserActivityStatus(RightNow.Chat.Model.ChatActivityState.RESPONDING,a),this._sneakPreviewLastSentTime=Date.now())},_getResultCodeFromExceptionCode:function(a){return a in this._exceptionCodeMap?this._exceptionCodeMap[a]:a},onLogonSuccess:function(a){a=a.responses&&a.responses[0]?a.responses[0]:{clientId:a.clientId,serviceStartTime:a.serviceStartTime,serviceFinishTime:a.serviceFinishTime,sessionId:a.sessionId,chatCreateEngagementResult:{cancelledSurveyId:a.cancelledSurveyId,cancelledSurveyAuth:a.cancelledSurveyAuth,completedSurveyId:a.completedSurveyId,completedSurveyAuth:a.completedSurveyAuth,sneakPreviewInterval:a.sneakPreviewInterval,engagementId:a.engagementId,sneakPreviewState:{value:a.sneakPreviewState},resultCode:{value:a.resultType||this._getResultCodeFromExceptionCode(a.exceptionCode)}}};clearTimeout(this._logonResponseTimer);var b=null;a&&(console.log(JSON.stringify(a.chatCreateEngagementResult)),b=a.chatCreateEngagementResult);if(b){var c=b.resultCode.value;this._chatCommunicator.setJavaSessionID(a.sessionId);this._myClientID=a.clientId;this._endUser.servletSessionID=a.sessionId;this._engagementID=b.engagementId;this._sneakPreviewState=b.sneakPreviewState.value;this._sneakPreviewInterval=b.sneakPreviewInterval;a.sessionId&&this.Y.Cookie.set("CHAT_SESSION_ID",a.sessionId,{path:"/",expires:new Date((new Date).getTime()+72E5)});0===this._cancelledSurveyID&&b.cancelledSurveyId&&(this._cancelledSurveyID=b.cancelledSurveyId,this._cancelledSurveyAuth=b.cancelledSurveyAuth);0===this._completedSurveyID&&b.completedSurveyId&&(this._completedSurveyID=b.completedSurveyId,this._completedSurveyAuth=b.completedSurveyAuth)}a=new RightNow.Event.EventObject;a.data.connected=!0;"EXISTING_SESSION"==c&&(a.data.existingSession=!0);RightNow.Event.fire("evt_chatConnectUpdate",a);a.data.existingSession||("FAIL_OUT_OF_HOURS"===c||"FAIL_HOLIDAY"===c||"FAIL_NO_AGENTS_AVAIL"===c||"FAIL_RULE_DEQUEUE"===c||null==b?this.setStateByReasonCode(c):(this._connected=!0,this.setState(RightNow.Chat.Model.ChatState.SEARCHING)))},onLogonFailure:function(a,b){var c=new RightNow.Event.EventObject;c.data.connected=!1;if(b&&b.response){if(c.data.response=JSON.parse(b.response),c.data.response.hasOwnProperty("exceptionCode")){var d=this._getResultCodeFromExceptionCode(c.data.response.exceptionCode);"FAIL_OUT_OF_HOURS"!==d&&"FAIL_HOLIDAY"!==d&&"FAIL_NO_AGENTS_AVAIL"!==d&&"FAIL_RULE_DEQUEUE"!==d||this.setStateByReasonCode(d)}}else console.error("Response data is empty, possible data connection loss."),this.setStateByReasonCode("PARTICIPANT_LEFT");RightNow.Event.fire("evt_chatConnectUpdate",c)},logon:function(a){if(!(0<this.Y.UA.ie&&8>=this.Y.UA.ie||a.data.isSpider)){a=a.data;this._endUser.firstName=a.firstName;this._endUser.lastName=a.lastName;this._endUser.email=a.email;var b={data:{action:RightNow.Chat.Model.ChatEndUserAction.LOGON,first_name:a.firstName,last_name:a.lastName,email:a.email,c_id:a.contactID,question:a.subject,org_id:a.organizationID,request_src:a.requestSource,prod_id:a.prod,cat_id:a.cat,survey_send_id:a.surveySendID,survey_send_delay:a.surveySendDelay,survey_send_auth:a.surveySendAuth,queue_id:a.queueID,intf_id:a.interfaceID,s_id:a.sessionID,i_id:a.incidentID,routing_data:a.routingData,referrer_url:a.referrerUrl,coBrowsePremiumSupported:a.coBrowsePremiumSupported,vaVersion:1,mediaList:a.mediaList},on:{success:this.onLogonSuccess,failure:this.onLogonFailure},scope:this};null!=a.resume&&(b.data.resume=a.resume?RightNow.Chat.Model.ChatCreateEngagementResumeCode.RESUME:RightNow.Chat.Model.ChatCreateEngagementResumeCode.DO_NOT_RESUME);for(var c in a.mediaList)b.data[a.mediaList[c].type]=a.mediaList[c];for(var d in a.miscellaneousData)b.data[d]=a.miscellaneousData[d];this._chatCommunicator.makeRequest(b)}},logonRest:function(a){0<this.Y.UA.ie&&8>=this.Y.UA.ie||a.data.isSpider||(a=a.data,this._endUser.firstName=a.firstName,this._endUser.lastName=a.lastName,this._endUser.email=a.email,this._chatCommunicator.makeRequest({data:{pool:a.pool},headers:{Authorization:"Bearer "+a.jwt,Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"},on:{success:this.onLogonSuccess,failure:this.onLogonFailure},scope:this},!0))},setCancelledSurveyID:function(a){this._cancelledSurveyID=a},setCancelledSurveyAuth:function(a){this._cancelledSurveyAuth=a},setCompletedSurveyID:function(a){this._completedSurveyID=a},setCompletedSurveyAuth:function(a){this._completedSurveyAuth=a},getCancelledSurveyID:function(){return this._cancelledSurveyID},getCancelledSurveyAuth:function(){return this._cancelledSurveyAuth},getCompletedSurveyID:function(){return this._completedSurveyID},getCompletedSurveyAuth:function(){return this._completedSurveyAuth},getEncodedAccountID:function(){return RightNow.Text.Encoding.base64Encode(this._accountID.toString())},getEndUser:function(){return this._endUser},getEngagementID:function(){return this._engagementID},setSearchPerformed:function(a){this._searchPerformed=a},setStateByReasonCode:function(a){var b=RightNow.Chat.Model.ChatState.DISCONNECTED;"FAIL_OUT_OF_HOURS"===a||"FAIL_HOLIDAY"===a||"FAIL_NO_AGENTS_AVAIL"===a||"ENDED_USER_CANCEL"===a||"QUEUE_TIMEOUT"===a||"ENDED_USER_DEFLECTED"===a?b=RightNow.Chat.Model.ChatState.CANCELLED:"FAIL_RULE_DEQUEUE"===a||"EJECTED"===a?b=RightNow.Chat.Model.ChatState.DEQUEUED:"TRANSFERRED_TO_QUEUE"==a&&(b=RightNow.Chat.Model.ChatState.REQUEUED);this._firstParticipant=!0;this.setState(b,a)},logoff:function(a,b){var c;b&&(c=this._searchPerformed?RightNow.Chat.Model.ChatConclusionReason.ENDED_USER_DEFLECTED:RightNow.Chat.Model.ChatConclusionReason.ENDED_USER_CANCEL);var d={data:{action:RightNow.Chat.Model.ChatEndUserAction.LOGOFF,reason:c},on:{success:this.onLogoffSuccess},scope:this};a&&(d.synchronous=!0);if(document.getElementById("videoSectionWrapper"))if(this.videoInlayLoaded)window.oit&&window.oit.fire(new CustomEvent("inlay-oracle-chat-video-statusNotification",{detail:{videoChatStatus:RightNow.Chat.Model.ChatVideoChatStatusCode.STOPPED,clientResponsible:!0,logoff:!0}}));else{var f=new RightNow.Event.EventObject(this,{data:{videoChatStatus:RightNow.Chat.Model.ChatVideoChatStatusCode.STOPPED}});RightNow.Event.fire("evt_chatVideoChatStatusResponse",f)}this._chatCommunicator.makeRequest(d);this.setStateByReasonCode(c)},onLogoffSuccess:function(a){this._connected=!1;this.Y.Cookie.get("CHAT_SESSION_ID")===this._endUser.servletSessionID&&this.Y.Cookie.remove("CHAT_SESSION_ID",{path:"/"});RightNow.Event.fire("evt_endChatSession",new RightNow.Event.EventObject(this,{}))},fetchUpdate:function(){var a=RightNow.Chat.Controller.ChatCommunicationsController;this._currentState!=RightNow.Chat.Model.ChatState.CANCELLED&&this._currentState!=RightNow.Chat.Model.ChatState.DEQUEUED&&this._currentState!=RightNow.Chat.Model.ChatState.DISCONNECTED&&(a={data:{action:RightNow.Chat.Model.ChatEndUserAction.GETUPDATE},on:{success:this.onFetchUpdate,failure:a.onFetchUpdateFailure},scope:this,useTransactionID:!0},0<this._fetchUpdateFailures&&(a.data.useContinuation=!1),this._responseSentMilliseconds&&(a.data.lastGetRequestMilliseconds=this._responseSentMilliseconds-((new Date).getTime()-this._beginProcessingTimestamp)),this.logDebug("Fetching update from chat service..."),this._timeUpdateRequested=(new Date).getTime(),this._chatCommunicator.makeRequest(a))},onFetchUpdate:function(a){a=a.responses;this._beginProcessingTimestamp=(new Date).getTime();this.logDebug("Update fetched from chat service in "+(this._beginProcessingTimestamp-this._timeUpdateRequested)+" milliseconds");var b=!1,c=!1,d=!1;0<this._fetchUpdateFailures&&(this._reconnectTimer&&(clearInterval(this._reconnectTimer),this._reconnectTimer=null),this._retryReconnect=!0,this._fetchUpdateFailures=0,this.containsError(a)||this.setState(this._stateBeforeReconnect),this._messageSendQueue.length-1>this._lastPostedMessageID&&this.postMessageHelper(this._lastPostedMessageID+1));if(a&&0<a.length)for(var f=0;f<a.length;f++){if(a[f].sequenceNumber&&!b&&(b=a[0].sequenceNumber,b=this._chatCommunicator.getLastTransactionID()===b),c=1==a[f].sequenceNumber&&1<a[f].getResponseTypes.length,a[f].getResponseTypes){this._responseSentMilliseconds=a[f].responseSentMilliseconds;for(var m=0;m<a[f].getResponseTypes.length;m++){var e=a[f].getResponseTypes[m],g=new RightNow.Event.EventObject,p=e.chatMessageType;try{switch(p){case "ChatQueuePositionNotification":g.data={position:e.position,expectedWaitSeconds:e.expectedWaitSeconds,averageWaitSeconds:e.averageWaitSeconds};RightNow.Event.fire("evt_chatQueuePositionNotification",g);break;case "ChatDisconnectNotification":var l=e.clientId,q=e.reason.value;g.data.createdTime=this.createServiceFinishTimestamp(e.createdTime);g.data.reason=q;g.data.disconnectClientId=l;l!==this._myClientID?g.data.agent=this._agents.getAgent(l):"AGENT_CONCLUDED"===q||"TRANSFERRED_TO_QUEUE"===q?g.data.agent=this._agents.getAgent(this._agents.getLeadAgentID()):g.data.isUserDisconnect=!0;RightNow.Event.fire("evt_chatDisconnectNotification",g);if("QUEUE_TIMEOUT"===q)this.setStateByReasonCode(q),this._connected=!1;else if("TRANSFERRED_TO_QUEUE"===q||"EJECTED"===q)this.setStateByReasonCode(q);else if(l===this._myClientID||"AGENT_CONCLUDED"===q||"NO_AGENTS_AVAILABLE"===q)this.setState(RightNow.Chat.Model.ChatState.DISCONNECTED,q),this._connected=!1,this.Y.Cookie.get("CHAT_SESSION_ID")===this._endUser.servletSessionID&&this.Y.Cookie.remove("CHAT_SESSION_ID",{path:"/"}),RightNow.Event.fire("evt_endChatSession",new RightNow.Event.EventObject(this,{}));break;case "ChatEngagementParticipantAdded":g.data.createdTime=this.createServiceFinishTimestamp(e.createdTime);g.data.role=e.role.value;g.data.agent=this._agents.addAgent(e.clientId,e.name,e.greeting,"LEAD"===e.role.value);g.data.virtualAgent=e.virtualAgent;RightNow.Event.fire("evt_chatEngagementParticipantAdded",g);this._firstParticipant&&(this._firstParticipant=!1,this.setState(RightNow.Chat.Model.ChatState.CONNECTED));this._accountID=e.accountId;break;case "ChatRoleChangeNotification":this._agents.setLeadAgentID(e.leadClientId);break;case "ChatActivitySignal":this._sneakPreviewState=e.sneakPreviewState.value;this._sneakPreviewInterval=e.sneakPreviewInterval;this.setAgentActivityStatus(e.clientId,e.mode.value);this._sneakPreviewFocus=e.sneakPreviewFocus;break;case "ChatPostMessage":var w=e.senderId;g.data.createdTime=this.createServiceFinishTimestamp(e.createdTime);g.data.messageBody=e.body;g.data.isOffTheRecord=e.offTheRecord;g.data.serviceFinishTime=this.createServiceFinishTimestamp(a[f].serviceFinishTime);"AGENT"===e.senderType.value?(this.setAgentActivityStatus(w,RightNow.Chat.Model.ChatActivityState.LISTENING),g.data.agent=this._agents.getAgent(e.senderId),g.data.richText=e.richText,e.vaResponse&&(g.data.vaResponse=this.Y.JSON.parse(e.vaResponse)),e.messageId&&(g.data.messageId=e.messageId)):(g.data.postMessage=!1,g.data.isEndUserPost=!0,g.data.endUser=this._endUser,g.data.richText=!1);RightNow.Event.fire("evt_chatPostMessageRequest",g);break;case "ChatCoBrowseInvitationMessage":g.data={modeType:e.modeType.value,coBrowseUrl:e.url,agent:this._agents.getAgent(e.senderId)};RightNow.Event.fire("evt_chatCobrowseInvitation",g);break;case "ChatCoBrowsePremiumInvitationMessage":g.data={agentEnvironment:e.agentEnvironmentString,coBrowseSessionId:e.cobrowseSessionId,agent:this._agents.getAgent(e.senderId)};RightNow.Event.fire("evt_chatCoBrowsePremiumInvitation",g);break;case "ChatCoBrowseStatusNotification":g.data.coBrowseStatus=e.status.value;g.data.coBrowseData=e.data;RightNow.Event.fire("evt_chatCobrowseStatusNotification",g);break;case "ChatMediaInvitationMessage":e.mediaType&&"VIDEO"===e.mediaType.value&&(g.data={videoChatSessionId:e.mediaSessionId,agent:this._agents.getAgent(e.senderId),isRestoringTranscript:c,engagementID:this.getEngagementID()},RightNow.Event.fire("evt_chatVideoChatInvitation",g));break;case "ChatMediaStatusNotification":if(e.mediaType&&"VIDEO"===e.mediaType.value){g.data.videoChatStatus=e.status.value;g.data.videoChatData=e.data;g.data.senderType=e.senderType.value;g.data.isRestoringTranscript=c;if("STARTED"===g.data.videoChatStatus)d=!0;else if("STOPPED"===g.data.videoChatStatus||"ERROR"===g.data.videoChatStatus||"ABORTED"===g.data.videoChatStatus)d=!1;RightNow.Event.fire("evt_chatVideoChatStatusNotification",g)}break;case "ChatMediaTokenMessage":e.mediaType&&"VIDEO"===e.mediaType.value&&(e.isRestoringTranscript=c,this.notifyVideoJWTAction(e));break;case "ChatEngagementUpdateNotification":var t=RightNow.Chat.Model.ChatParticipantConnectionState,r=e.clientId,u=e.connectionState.value;u===t.ABSENT&&r!==this._myClientID?(this._agents.getAgent(r).activityStatus!==t.ABSENT&&this.setAgentActivityStatus(r,RightNow.Chat.Model.ChatActivityState.ABSENT),this._agents.getLeadAgentID()===r&&(g.data.requeueSeconds=e.secondsToDisconnect,RightNow.Event.fire("evt_chatAgentAbsentUpdate",g))):u===t.ACTIVE&&r!==this._myClientID?this.setAgentActivityStatus(r,RightNow.Chat.Model.ChatActivityState.LISTENING):u==t.DISCONNECTED&&r!==this._myClientID&&r!==this._agents.getLeadAgentID()&&(g.data.reason=RightNow.Chat.Model.ChatDisconnectReason.CONFREE_DISCONNECTED,g.data.disconnectClientId=r,g.data.agent=this._agents.getAgent(r),RightNow.Event.fire("evt_chatDisconnectNotification",g));break;case "ChatConfigChangeNotification":"CHAT_CLUSTER_POOL_ID"===e.name&&this._chatCommunicator.setClusterPoolID(e.value);break;case "ChatVaPassthroughMessage":g.data.content=this.Y.JSON.parse(e.content);RightNow.Event.fire("evt_chatVaPassthroughMessage",g);break;case "ChatSystemError":this.setState(RightNow.Chat.Model.ChatState.DISCONNECTED,"ERROR"),this._connected=!1}}catch(x){this.logDebug("Error processing "+p+": "+x)}}}}else this.setState(RightNow.Chat.Model.ChatState.DISCONNECTED,"ERROR"),this._connected=!1;d&&c&&(l=new RightNow.Event.EventObject(this,{data:{videoChatStatus:RightNow.Chat.Model.ChatVideoChatStatusCode.ABORTED}}),this.videoInlayLoaded&&window.oit?window.oit.fire(new CustomEvent("inlay-oracle-chat-video-statusNotification",{detail:{videoChatStatus:RightNow.Chat.Model.ChatVideoChatStatusCode.ABORTED,clientResponsible:!0,isRestoringTranscript:!0,chatSessionId:this.Y.Cookie.get("CHAT_SESSION_ID"),engagementID:this._engagementID}})):RightNow.Event.fire("evt_chatVideoChatStatusResponse",l));b&&RightNow.Event.fire("evt_chatFetchUpdateComplete",null)},onFetchUpdateFailure:function(a){this.logDebug("Fetch update failure after "+((new Date).getTime()-this._timeUpdateRequested)+" milliseconds");var b=this;this._fetchUpdateFailures++;this._postMessageResponseTimer&&(clearTimeout(this._postMessageResponseTimer),this._postMessageResponseTimer=null);this._retryReconnect?(null===this._reconnectTimer&&(this._reconnectTimer=setInterval(function(){RightNow.Chat.Controller.ChatCommunicationsController.reconnectIntervalExpired.apply(b)},this._absentIntervalMS)),1===this._fetchUpdateFailures&&(this._currentAbsentInterval=0,this._stateBeforeReconnect=this._currentState,this.Y.Cookie.get("pc_chat_state")&&"y"==this.Y.Cookie.get("pc_ls_support")?this._browserState==RightNow.Chat.Model.NavigationType.NAVIGATE_AWAY&&this.setState(RightNow.Chat.Model.ChatState.RECONNECTING):this.setState(RightNow.Chat.Model.ChatState.RECONNECTING),this.updateReconnectStatus()),a&&-1===a.status?this.fetchUpdate():setTimeout(function(){RightNow.Chat.Controller.ChatCommunicationsController.fetchUpdate.apply(b)},5E3)):(this.setState(RightNow.Chat.Model.ChatState.DISCONNECTED,"RECONNECT_FAILED"),this._connected=!1)},containsError:function(a){for(var b=0;b<a.length;b++)if(null!=a[b].getResponseTypes)for(var c=0;c<a[b].getResponseTypes.length;c++)if("ChatSystemError"===a[b].getResponseTypes[c].chatMessageType)return!0;return!1},reconnectIntervalExpired:function(){this._currentAbsentInterval++;this._currentAbsentInterval>=this._maxAbsentIntervals?(this._retryReconnect=!1,this._reconnectTimer&&(clearInterval(this._reconnectTimer),this._reconnectTimer=null)):RightNow.Chat.Controller.ChatCommunicationsController.updateReconnectStatus()},updateReconnectStatus:function(){var a=new RightNow.Event.EventObject;a.data.secondsLeft=(this._maxAbsentIntervals-this._currentAbsentInterval)*this._absentIntervalMS/1E3;RightNow.Event.fire("evt_chatReconnectUpdate",a)},isMessageAllowed:function(a,b){return this._chatCommunicator.makeRequest({data:{action:RightNow.Chat.Model.ChatEndUserAction.SEND_TEXT,msg:a,offTheRecord:b},testAllowed:!0})},postMessage:function(a,b){""!=a&&(this._messageSendQueue[this._messageSendQueue.length]={data:{action:RightNow.Chat.Model.ChatEndUserAction.SEND_TEXT,msg:a,offTheRecord:b}},!1===this._currentlySendingMessage&&this.postMessageHelper(this._messageSendQueue.length-1));return this._messageSendQueue.length-1},postMessageHelper:function(a){this._currentlySendingMessage=!0;var b=this._messageSendQueue[a];b.callbackArgument=a;b.on={failure:this.onPostMessageFailure,success:this.onPostMessageSuccess};b.scope=this;this._chatCommunicator.makeRequest(b);this._endUser.activityStatus=RightNow.Chat.Model.ChatActivityState.LISTENING;clearTimeout(this._statusTimerId)},postOutOfBandData:function(a){a&&(a="object"===typeof a&&a?RightNow.JSON.stringify(a):a,this._chatCommunicator.makeRequest({data:{action:RightNow.Chat.Model.ChatEndUserAction.OUT_OF_BAND_DATA,msg:a}}))},onPostMessageSuccess:function(a){clearTimeout(this._postMessageResponseTimer);var b=parseInt(a.data,10);this._lastPostedMessageID=b;this._postMessageRetryCount=0;if(a.error)this.onPostMessageFailure();else{if(a.responses&&3E4<(new Date).getTime()-this._timeUpdateRequested){var c=a.responses[0];c&&c.chatPostResult&&2===c.chatPostResult.clientReset&&this.fetchUpdate()}RightNow.Event.fire("evt_chatPostCompletion",b,this.createServiceFinishTimestamp(a.responses[0].serviceFinishTime));this._messageSendQueue[b+1]?this.postMessageHelper(b+1):this._currentlySendingMessage=!1}},onPostMessageFailure:function(){var a=this;this._postMessageRetryCount++;5>=this._postMessageRetryCount?this._postMessageResponseTimer=setTimeout(function(){RightNow.Chat.Controller.ChatCommunicationsController.postMessageHelper.apply(a,[a._lastPostedMessageID+1])},15E3):(this.setState(RightNow.Chat.Model.ChatState.DISCONNECTED,"ERROR"),this._connected=!1)},onActivitySignalChangeSuccess:function(a){a.responses&&(a=a.responses[0])&&a.chatActivitySignalChangeResult&&a.chatActivitySignalChangeResult.sneakPreviewState&&(this._sneakPreviewState=a.chatActivitySignalChangeResult.sneakPreviewState.value,this._sneakPreviewInterval=a.chatActivitySignalChangeResult.sneakPreviewInterval)},onActivitySignalChangeFailure:function(){},notifyFileAttachSuccess:function(a){null!=a.responses&&RightNow.Event.fire("evt_chatNotifyFattachUpdate",a.responses)},notifyFileAttach:function(){this._chatCommunicator.makeRequest({data:{action:RightNow.Chat.Model.ChatEndUserAction.NOTIFY_FATTACH,engagementId:this._engagementID,sessionId:this._endUser.servletSessionID},on:{success:this.notifyFileAttachSuccess},scope:this})},notifyFileUploadSuccess:function(a){null!==a.responses&&RightNow.Event.fire("evt_chatNotifyFileUploadUpdate",a.responses,RightNow.JSON.parse(a.data))},notifyFileUploaded:function(a){var b={error:a.data.error,name:a.data.name,size:a.data.size,transactionID:a.data.transactionID},b=RightNow.JSON.stringify(b);return this._chatCommunicator.makeRequest({data:{action:RightNow.Chat.Model.ChatEndUserAction.FATTACH_UPLOAD,engagementId:this._engagementID,sessionId:this._endUser.servletSessionID,status:0===a.data.error?"RECEIVED":"ERROR",localFName:a.data.tmp_name,userFName:a.data.name,contentType:a.data.type,fileSize:a.data.size},callbackArgument:b,on:{success:this.notifyFileUploadSuccess},scope:this})},sendCoBrowseAction:function(a){this._chatCommunicator.makeRequest({data:{action:RightNow.Chat.Model.ChatEndUserAction.COBROWSE,cobrowse_action:a}})},sendVideoChatAction:function(a,b){var c={data:{action:"MEDIA",mediaType:"VIDEO",mediaAction:a}};"ACCEPTED"===a&&(c={data:{action:"MEDIA",mediaType:"VIDEO",mediaAction:a},callbackArgument:b,on:{success:this.notifyVideoActionSuccess},scope:this});this._chatCommunicator.makeRequest(c)},notifyVideoActionSuccess:function(a){},notifyVideoJWTAction:function(a){a&&a.token&&a.mediaType&&"VIDEO"===a.mediaType.value&&!a.isRestoringTranscript&&(a={mediaType:a.mediaType,multiChannelSiteId:a.multiChannelSiteId,mediaToken:a.token,endPoint:a.endpoint,videoChatSessionId:a.mediaSessionId},RightNow.Event.fire("evt_chatVideoChatInitiate",a),window.oit&&window.oit.fire(new CustomEvent("inlay-oracle-chat-video-initiate",{detail:a})))},logDebug:function(a){if(void 0!==window.console&&void 0!==window.console.log){var b=this.Y.Cookie.get("location");b&&(b=b.split("~"));b&&b[0]&&(b=b[0]);"development"===b&&window.console.log(a)}},createServiceFinishTimestamp:function(a){var b=a.match(this._xmlDateRE),c=null;b&&(c=(new Date(Date.UTC(b[1],b[2]-1,b[3],b[4],b[5],b[6],b[7]?b[7]:""))).getTime(),"Z"!==a.slice(-1)&&(b=0,-1<["+","-"].indexOf(a.slice(-6).substring(0,1))?(a=a.slice(-6).match(new RegExp(/^([+-])([0-9]{2}):([0-9]{2})$/)))&&(b=("-"===a[1]?"+":"-")+(60*parseInt(a[2],10)+parseInt(a[3],10))):b=(new Date).getTimezoneOffset(),c+=6E4*b));return c}};RightNow.namespace("RightNow.Chat.LS");RightNow.Chat.LS=function(){var a={_transcriptPrefix:"pctranscript",_disconnectPrefix:"pcdisconnect",_bufferPrefix:"pcbuffer",_windowStateKey:"pcwinstate",_connectStatusKey:"pcconnectstatus",_testKey:"pctestkey",_lastUpdateKey:"pclastupdated",_soundButtonSyncKey:"pcsoundonoff",_chatLaunchedKey:"pcchatlaunched",_udataKey:"pcudata"};a._thisWindowId=(new Date).getTime();a.attachStoreEvent=function(){window.addEventListener("storage",a.receiveStoreEvent,!1)};a.receiveStoreEvent=function(b){if(null!==b.newValue&&b.key!==a._testKey){try{var c=JSON.parse(b.newValue)}catch(m){return}if(!c.hasOwnProperty("chatWindowId")||c.chatWindowId!==a._thisWindowId)switch(b.key===a._windowStateKey&&RightNow.Event.fire("evt_setWindowState",new RightNow.Event.EventObject(this,{})),c.type){case "CHAT_TRANSCRIPT":c=a.getItem(b.key);void 0===c&&(c=JSON.parse(b.newValue));b=new RightNow.Event.EventObject(this,{data:c});RightNow.Event.fire("evt_addChat",b);break;case "CHAT_BUFFER":RightNow.Event.fire("evt_setChatWindow",new RightNow.Event.EventObject(this,{}));break;case "CHAT_CONNECT_STATUS":c=a.getItem(b.key);RightNow.Event.fire("evt_syncChatConnectStatus",new RightNow.Event.EventObject(this,{data:c}));break;case "CHAT_SOUND_STATE":c=a.getItem(b.key);RightNow.Event.fire("evt_soundButtonSync",new RightNow.Event.EventObject(this,{data:c}));break;case "CHAT_LAUNCHED":c=a.getItem(b.key);RightNow.Event.fire("evt_chatLaunchedNotify",new RightNow.Event.EventObject(this,{data:c}));break;case "CHAT_DISCONNECT":c=a.getItem(b.key),void 0===c&&(c=JSON.parse(b.newValue)),RightNow.Event.fire("evt_notifyChatDisconnect",new RightNow.Event.EventObject(this,{data:c}))}}};var b;try{window.localStorage.setItem(a._testKey,"test"),window.localStorage.removeItem(a._testKey),b=!0}catch(c){b=!1}a.isSupported=b;a.bufferItem=function(b,c){if(this.isSupported&&b){var m=a.getItem(this._bufferPrefix+b);m||(m=[]);m.push(c);a.setItem(this._bufferPrefix+b,m)}};a.setItem=function(a,b){if(this.isSupported&&a&&void 0!==b)try{window.localStorage.setItem(a,JSON.stringify(b))}catch(c){}};a.getItem=function(a){if(this.isSupported&&(a=window.localStorage.getItem(a),"string"==typeof a))try{return JSON.parse(a)}catch(b){}};a.removeItem=function(a){this.isSupported&&a&&window.localStorage.removeItem(a)};a.removeAllPCItems=function(){if(this.isSupported)for(var a=window.localStorage,b=[this._transcriptPrefix,this._bufferPrefix,this._connectStatusKey,this._lastUpdateKey,this._chatLaunchedKey,this._udataKey],c=b.length,e=a.length,g,p=0;p<e;p++)if(g=a.key(p),"string"===typeof g)for(var l=0;l<c;l++)g.substring(0,b[l].length)===b[l]&&a.removeItem(g)};return a}();